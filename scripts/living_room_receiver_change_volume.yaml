---
# TODO: This script is dodgy _and_ never used. Clean it and start using it
living_room_receiver_change_volume:
  alias: Receiver - Volume Change
  sequence:
    service: mqtt.publish
    data_template:
      topic: "cmnd/Living_room_-_IR_send/irsend"
      payload_template: >
        {%- set protocol = "NEC" -%}
        {%- set volume_change_int = states.input_number.volume_change.state|int -%}
        {%- set volume_change_abs = volume_change_int|abs %}
        {%- set bits = 32 -%}
        {%- if volume_change_int < 0 -%}
          {%- set data = "0x4BB6C03F" -%}
        {%- elif volume_change_int > 0 -%}
          {%- set data = "0x4BB640BF" -%}
        {%- endif -%}

        {%- if volume_change_abs in range(16, 21) -%}
          {%- set repeat = 30 -%}
        {%- elif volume_change_abs in range(11, 16) -%}
          {%- set repeat = 15 %}
        {%- elif volume_change_abs in range(6, 11) -%}
          {%- set repeat = 10 -%}
        {%- elif volume_change_abs in range(2, 6) -%}
          {%- set repeat = 5 -%}
        {%- elif volume_change_abs == 1 -%}
          {%- set repeat = 0 -%}
        {%- endif -%}
        {"Protocol":"{{ protocol }}","Bits":{{ bits }},"Data":{{ data }},"Repeat":{{ repeat }}}
